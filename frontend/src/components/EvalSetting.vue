<template>
	<v-row class="flex-column pa-1">
		<div style="display: flex; align-items: center;">
			<h4>Ground Truth Data List</h4>
			<v-tooltip text="Select or upload annotation files of XML format.">
				<template v-slot:activator="{ props }">
					<v-btn icon="mdi-information" variant="plain" v-bind="props">
						<v-icon icon="mdi-information" v-bind="props" color="#e39a39"></v-icon>
					</v-btn>
				</template>
			</v-tooltip>
		</div>
		<v-table fixed-header height="200px" density="compact" style="color: #504f5a;">
			<thead>
				<tr>
					<th><GroundTruthUpload @clicked-Upload="getList"></GroundTruthUpload></th>
					<th>ID</th>
					<th>GT Name</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr v-for="gt in gt_list" :key="gt.gt_id">
					<td style="text-align: center;"><input v-model="selected_gt_id" class="form-check-input" type="radio" :value="gt.gt_id" :checked="gt_id === gt.gt_id"></td>
					<td>{{ gt.gt_id }}</td>
					<td>{{ gt.gt_name }}</td>
					<td style="text-align: center;"><v-icon icon="mdi-trash-can" @click="deleteList('gt_'+gt.gt_id)" color="#0D6EFD"></v-icon></td>
				</tr>
			</tbody>
		</v-table>
	</v-row>
		
	<v-row class="flex-column pa-1">
		<div style="display: flex; align-items: center;">
			<h4>Inferred Result Data List</h4>
			<v-tooltip text="Select or upload a text file generated by the OD model.">
				<template v-slot:activator="{ props }">
					<v-btn icon="mdi-information" variant="plain" v-bind="props">
						<v-icon icon="mdi-information" v-bind="props" color="#e39a39"></v-icon>
					</v-btn>
				</template>
			</v-tooltip>
		</div>
		<v-table fixed-header height="200px" density="compact" style="color: #504f5a;">
			<thead>
				<tr>
					<th><InferUpload @clicked-Upload="getList"></InferUpload></th>
					<th>ID</th>
					<th>Model Name</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr v-for="infer in infer_list" :key="infer.infer_id">
					<td style="text-align: center;"><input v-model="selected_infer_id" class="form-check-input" type="radio" :value="infer.infer_id" :checked="infer_id === infer.infer_id"></td>
					<td>{{ infer.infer_id }}</td>
					<td>{{ infer.model_name }}</td>
					<td style="text-align: center;"><v-icon icon="mdi-trash-can" @click="deleteList('infer_'+infer.infer_id)" color="#0D6EFD"></v-icon></td>
				</tr>
			</tbody>
		</v-table>
		<input type="hidden" name="class_iou_list" value='[{"class_name":"all", "iou_th":0.5}]'>
	</v-row>
	
	<v-row class="pa-0" justify="end">
		<v-btn variant="flat" color="#0D6EFD" @click="getEvaluateResult()">Evaluate</v-btn>
	</v-row>
	
	<v-row class="flex-column pa-2">
		<div style="display: flex; align-items: center;">
			<h4>IoU Threshold Setting</h4>
			<v-tooltip text="Select the class name for evaluation.
			Adjust the IoU threshold used for correct and incorrect detections.">
				<template v-slot:activator="{ props }">
					<v-btn icon="mdi-information" variant="plain" v-bind="props">
						<v-icon icon="mdi-information" v-bind="props" color="#e39a39"></v-icon>
					</v-btn>
				</template>
			</v-tooltip>
		</div>
		<v-table fixed-header height="200px" density="compact" style="color: #504f5a;">
			<thead>
				<tr>
					<th>Class</th>
					<th></th>
					<th>IoU Threshold</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr v-for="class_iou in class_iou_list" :key="class_iou.class_name" style="vertical-align: middle;">
					<td><v-switch small v-model="class_iou.checked" color="#0D6EFD" :value="true" hide-details :model-value="class_iou.checked"></v-switch></td>
					<td>{{class_iou.class_name}}</td>
					<td><input class="form-range" type="range" v-model="class_iou.iou_th" max="0.9" min="0.1" step="0.1" hide-details></td>
					<td>{{class_iou.iou_th}}</td>
				</tr>
			</tbody>
		</v-table>
	</v-row>
	
	<v-row class="pa-0" justify="end">
		<v-btn variant="flat" color="#0D6EFD" @click="updateClassIouList()">Apply</v-btn>
	</v-row>

</template>

<script>
import GroundTruthUpload from './cards/GroundTruthUpload_card.vue'
import InferUpload from './cards/InferUpload_card.vue'

import axios from 'axios';

export default {
  name: 'EvalSetting',
  components: {
    GroundTruthUpload, InferUpload
  },

  props: ['gt_id', 'infer_id', 'class_iou_list'],
  
  data() {
    return {
      selected_gt_id: null,
      selected_infer_id: null,
      gt_list: [],
      infer_list: [],
    };
  },

  methods: {
    getList(){
    //   axios.get('http://localhost:5000/getList')
      axios.get('/getList')
      .then(response => {
        this.gt_list = response.data.gt_list;
        this.infer_list = response.data.infer_list;
        console.log('succeeded /getList');
      })
    },
    deleteList(value){
    //   axios.get('http://localhost:5000/deleteList', {
      axios.get('/deleteList', {
        params: {
          delete_info: value,
        }
      })
      .then(() => {
        console.log('succeeded /deleteList');
        this.getList()
      })
    },
    getEvaluateResult(){
      const new_gt_id = this.selected_gt_id;
      const new_infer_id = this.selected_infer_id;
      this.$emit('clicked-evaluate', new_gt_id, new_infer_id)
    },
    updateClassIouList(){
      this.$emit('clicked-apply', false);
    },
  },

  mounted(){
    this.getList();
  },
}
</script>
